#!/usr/bin/env bash
#? [LINTING] Analyzes the codebase with Ruff and Pyright

set -eo pipefail
cd "$(dirname "$0")/../.."

# Usage documentation
function usage {
    cat<<EOF
Usage: $0 [--fix]

Options:
  --fix    Automatically fix issues
EOF
}

while :; do
    case $1 in
        -h|--help) usage; exit ;;
        --fix) fix=1 ;;
        *) break ;;
    esac
    shift
done

uv run pyright

if [[ $fix ]]; then
    uv run ruff check --fix --exit-non-zero-on-fix
    uv run ruff format
else
    uv run ruff check
    uv run ruff format --check
fi